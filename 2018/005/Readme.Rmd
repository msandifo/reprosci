---
title: '005'
output: github_document
always_allow_html: yes
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE,  message=FALSE, warning=FALSE)

drake.path<-'~/Dropbox/msandifo/documents/programming/r/twitter/2018/005/'
full.repro<-F
library(reproscir)
source('./src/settings.R')
source('./src/theme.R')
source('./src/functions.R')
source('./src/plan.R')
#load(paste0(drake.path, '/data/data.Rdata'))
source('./src/downloads.R')

```

##  Description

Norway and Australia are both major exporters of fossil fuels. Despite similar balances in the early 1990's, the structural budget balances have changed dramatically since then, due to a range of factors. Including rather different commodity mixes (more oil and gas in Norway, more coal in Australia which ahs net oil imports) , but also very different petroleum royalty/taxation regimes (see [Paul Cleary's _Trillion dollar baby_, BlackInc Books, 2016](https://www.blackincbooks.com.au/books/trillion-dollar-baby)).
These charts illustrate how the energy export and government financial outlooks have evolved for both countries. Depsite a three-fold increase in fossil fuel exports (in energ equivalent terms)  since 1990, Australia now has a very signficant structral deficit with interest of around US$12 billion per year. Meanwhile, Norway whose exports have increased by about 170% since 1990, has contributed US$120,000  per person to its sovereign wealth fund.



## Data Sources


* [BP statistical-review of energy, 2018 edition](https://www.bp.com/content/dam/bp/en/corporate/excel/energy-economics/statistical-review/bp-stats-review-2018-all-data.xlsx). The BP data is distributed as an Excel spreadsheet. Here I use the  fossil fuel production and consumption data, aggregated in energy equivalent  ```mtoe``` terms (million tonnes oil-equivalent).

* [IMF world energy outlook](https://www.imf.org/external/pubs/ft/weo/2018/01/weodata/WEOApr2018all.xls). The IMF WEO is distributed as an Excel spreadsheet. Here I use the population data (LP, reported in millions) and, as a measure of goverenrment revenue and expenditure (```GGXCNL``` and ```GGXONLB```),  reported in billions in local currency terms. The valeus are converetd to US$ using ```NGDPDPC``` and ```NGDPPC```. interest is calculated as ```GGXONLB-GGXONLB``` where
  + ```GGXONLB``` Primary net lending/borrowing is net lending (+)/borrowing (?) plus net interest payable/paid (interest expense minus interest revenue).
  + ```GGXCNL``` Net lending (+)/ borrowing (?) is calculated as revenue minus total expenditure. This is a core GFS balance that measures the extent to which general government is either putting financial resources at the disposal of other sectors in the economy and nonresidents (net lending), or utilizing the financial resources generated by other sectors and nonresidents (net borrowing). This balance may be viewed as an indicator of the financial impact of general government activity on the rest of the economy and nonresidents (GFSM 2001, paragraph 4.17). Note: Net lending (+)/borrowing (?) is also equal to net acquisition of financial assets minus net incurrence of liabilities.

##  Caveats


## Code

The code base is in ```r``` and is managed  within RStudio, using  the  ```drake```  package, and my ```reoproscir``` package on ```github```  obtained with ```devtools::install_github('msandifo/reproscir')```. _Note this package is very much a  work in progress, and while it  is installed automagically,it will likely need reinstalling with _```devtools::install_github('msandifo/reproscir')```.

The code can be executed by opening the ```Rstudio``` project  ```005.Rproj```
and sourcing ```drake.R```.

```{r echo=T, eval=F}
source('drake.R')
```
Details of the steps invoked by ```drake.R` are summarised below.

* `source('./src/packages.R')` checks for and automatically installs missing package dependencies
<!-- ```tidyverse```, ```ggplot2```, ```magrittr```, ```purrr```, ```stringr```, ```drake```, ```lubridate```, ```rvest```, ```rappdirs```,```data.table```, ```fasttime```, ```devtools```, ```wbstats```  -->
<!--  from cran, and ```hrbrthemes```  and ```reproscir``` from the github repos ```hrbrmstr/hrbrthemes``` and ```msandifo/reproscir``` -->

* `source('./src/settings.R')` sets variables, such as the ```drake.path```,
* `source('./src/functions.R')` reads in data processing functions not in ```reproscir```
* `source('./src/theme.R')`  sets the ggplot theme derived from ```hrbrthemes```
* `source('./src/plots.R')` plot functions
* `source('./src/downloads.R')` directs the download of the  relevant data files to be downloaded  into the local directory set by
``` local.path```. By default ``` local.path=NULL``` in which case data is downloaded via ```rappdirs::user_cache_dir()``` to a folder in the users cache directory (for macOSX, ```~/Library/cache```) to ```file.path(local.path, aemo)```.


* `source('./src/plan.R')` defines the drake plan ```reproplan```
with the dependency structure
```{r drake_plan, echo=TRUE, cache=F}
source('./src/settings.R')
source('./src/theme.R')
source('./src/functions.R')
source('./src/plots.R')
source('./src/plan.R')
drake::make( reproplan )
config <- drake::drake_config(reproplan)
graph <- drake::drake_graph_info(config, group = 'status', clusters = 'imported')
drake::render_drake_graph(graph, file='figs/rmd_render_drake.png')
```

<img src='./figs/rmd_render_drake.png' alt='hist1' align='center' style = 'border: none; float: center;' width = '1000px'>

Note that ```reproplan``` processes the files downloaded  by ```./src/downloads.R```, returning ```merged.data```
```{r  cache=FALSE}
print(head(readd(merged.data)))

```

* ```source(drake::make( reproplan ))```

* ```source('./src/ouputs.R')```
output charts  to the ```./figs``` directory :

```{r  echo=TRUE, cache=TRUE, eval=F}
p005<-drake::readd(p005)

 ```
 <img src="./figs/p005_01.png" alt="hist1" align="center" style = "border: none; float: center;" width = "1000px">
<img src="./figs/p005_02.png" alt="hist1" align="center" style = "border: none; float: center;" width = "1000px">
<img src="./figs/p005_03.png" alt="hist1" align="center" style = "border: none; float: center;" width = "1000px">
<img src="./figs/p005_04.png" alt="hist1" align="center" style = "border: none; float: center;" width = "1000px">
<img src="./figs/p005_05.png" alt="hist1" align="center" style = "border: none; float: center;" width = "1000px">
<img src="./figs/p005_06.png" alt="hist1" align="center" style = "border: none; float: center;" width = "1000px">
<img src="./figs/p005_07.png" alt="hist1" align="center" style = "border: none; float: center;" width = "1000px">

## Code Notes


## Errata
